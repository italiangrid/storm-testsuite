*** Settings ***

Resource   lib/webdav.txt
Resource   lib/clientSRM.txt
Resource   lib/credentials.txt

*** Test Cases ***

######## GET #########

WebDAV GET existent VOMS proxy storage area file as anonymous
  [Tags]  webdav  forbidden  get
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}
  ${output}  WebDAV GET  ${davEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${filename}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV GET existent VOMS proxy storage area file with plain proxy
  [Tags]  webdav  forbidden  get
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${output}  WebDAV GET  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${filename}  ${plainproxy}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV GET existent plain proxy storage area file as anonymous
  [Tags]  webdav  forbidden  get
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${PLAINPROXY_SA}  ${plainproxy}
  ${output}  WebDAV GET  ${davEndpoint}  ${PLAINPROXY_SA}  ${TESTDIR}/${filename}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV GET existent VOMS proxy storage area directory as anonymous
  [Tags]  webdav  forbidden  get
  ${output}  WebDAV GET  ${davEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV GET existent VOMS proxy storage area directory with plain proxy
  [Documentation]  It retrieves 500 instead of 403
  [Tags]  webdav  forbidden  get  to-be-fixed
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${output}  WebDAV GET  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}  ${plainproxy}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV GET existent plain proxy storage area directory as anonymous
  [Tags]  webdav  forbidden  get
  ${output}  WebDAV GET  ${davEndpoint}  ${PLAINPROXY_SA}  ${TESTDIR}
  Log  ${output}
  Should Contain  ${output}  403

######## HEAD #########

WebDAV HEAD existent VOMS proxy storage area file as anonymous
  [Tags]  webdav  forbidden  head
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}
  ${output}  WebDAV HEAD  ${davEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${filename}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV HEAD existent VOMS proxy storage area file with plain proxy
  [Documentation]  It retrieves 200 OK instead of 403
  [Tags]  webdav  forbidden  head  to-be-fixed
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${output}  WebDAV HEAD  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${filename}  ${plainproxy}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV HEAD existent plain proxy storage area file as anonymous
  [Tags]  webdav  forbidden  head
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${PLAINPROXY_SA}  ${plainproxy}
  ${output}  WebDAV HEAD  ${davEndpoint}  ${PLAINPROXY_SA}  ${TESTDIR}/${filename}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV HEAD existent VOMS proxy storage area directory as anonymous
  [Tags]  webdav  forbidden  head
  ${output}  WebDAV HEAD  ${davEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV HEAD existent VOMS proxy storage area directory with plain proxy
  [Documentation]  It retrieves 500 instead of 403
  [Tags]  webdav  forbidden  head  to-be-fixed
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${output}  WebDAV HEAD  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}  ${plainproxy}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV HEAD existent plain proxy storage area directory as anonymous
  [Tags]  webdav  forbidden  head
  ${output}  WebDAV HEAD  ${davEndpoint}  ${PLAINPROXY_SA}  ${TESTDIR}
  Log  ${output}
  Should Contain  ${output}  403

######## PUT #########

WebDAV PUT file into VOMS proxy storage area as anonymous
  [Tags]  webdav  forbidden  put
  ${filename}  Get a unique name
  ${output}  WebDAV PUT data  ${davEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${filename}  test  T
  Log  ${output}
  Should Contain  ${output}  403

WebDAV PUT file into plain proxy storage area as anonymous
  [Tags]  webdav  forbidden  put
  ${filename}  Get a unique name
  ${output}  WebDAV PUT data  ${davEndpoint}  ${PLAINPROXY_SA}  ${TESTDIR}/${filename}  test  T
  Log  ${output}
  Should Contain  ${output}  403

WebDAV PUT file into VOMS proxy storage area with plain proxy
  [Tags]  webdav  forbidden  put
  ${filename}  Get a unique name
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${output}  WebDAV PUT data  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${filename}  test  T  ${plainproxy}
  Log  ${output}
  Should Contain  ${output}  403

######## DELETE #########

WebDAV DELETE existent VOMS proxy storage area file as anonymous
  [Tags]  webdav  forbidden  delete
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}
  ${output}  WebDAV DELETE  ${davEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${filename}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV DELETE existent VOMS proxy storage area file with plain proxy
  [Tags]  webdav  forbidden  delete
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${output}  WebDAV DELETE  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${filename}  ${plainproxy}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV DELETE existent plain proxy storage area file as anonymous
  [Tags]  webdav  forbidden  delete
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${PLAINPROXY_SA}  ${plainproxy}
  ${output}  WebDAV DELETE  ${davEndpoint}  ${PLAINPROXY_SA}  ${TESTDIR}/${filename}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV DELETE existent VOMS proxy storage area directory as anonymous
  [Tags]  webdav  forbidden  delete
  ${dirname}  Get a unique name
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${output}  WebDAV MKCOL  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${dirname}  ${vomsproxy}
  Should Contain  ${output}  201 Created
  ${filename}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}  ${TESTDIR}/${dirname}
  ${output}  WebDAV DELETE  ${davEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${dirname}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV DELETE existent VOMS proxy storage area directory with plain proxy
  [Tags]  webdav  forbidden  delete
  ${dirname}  Get a unique name
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${output}  WebDAV MKCOL  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${dirname}  ${vomsproxy}
  Should Contain  ${output}  201 Created
  ${filename}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}  ${TESTDIR}/${dirname}
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${output}  WebDAV DELETE  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${dirname}  ${plainproxy}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV DELETE existent plain proxy storage area directory as anonymous
  [Tags]  webdav  forbidden  delete
  ${dirname}  Get a unique name
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${output}  WebDAV MKCOL  ${davSecureEndpoint}  ${PLAINPROXY_SA}  ${TESTDIR}/${dirname}  ${plainproxy}
  Should Contain  ${output}  201 Created
  ${filename}  Upload file  ${davSecureEndpoint}  ${PLAINPROXY_SA}  ${plainproxy}  ${TESTDIR}/${dirname}
  ${output}  WebDAV DELETE  ${davEndpoint}  ${PLAINPROXY_SA}  ${TESTDIR}/${dirname}
  Log  ${output}
  Should Contain  ${output}  403

######## MKCOL #########

WebDAV MKCOL into VOMS proxy storage area as anonymous
  [Tags]  webdav  forbidden  mkcol
  ${dirname}  Get a unique name
  ${output}  WebDAV MKCOL  ${davEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${dirname}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV MKCOL into plain proxy storage area as anonymous
  [Tags]  webdav  forbidden  mkcol
  ${dirname}  Get a unique name
  ${output}  WebDAV MKCOL  ${davEndpoint}  ${PLAINPROXY_SA}  ${TESTDIR}/${dirname}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV MKCOL into VOMS proxy storage area with plain proxy
  [Tags]  webdav  forbidden  mkcol
  ${dirname}  Get a unique name
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${output}  WebDAV MKCOL  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${dirname}  ${plainproxy}
  Log  ${output}
  Should Contain  ${output}  403

######## PROPFIND ##########

WebDAV PROPFIND allprop on file into VOMS proxy storage area as anonymous
  [Tags]  webdav  forbidden  propfind
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}  ${TESTDIR}
  ${bodyvalue}  Get PROPFIND ALLPROP body
  ${output}  WebDAV PROPFIND  ${davEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${filename}  ${bodyvalue}
  Log  ${output}
  Should Not Contain  ${output}  207 Multi-status
  Should Contain  ${output}  403

WebDAV PROPFIND allprop on file into VOMS proxy storage area with plain proxy
  [Documentation]  It retrieves 500 instead of 403
  [Tags]  webdav  forbidden  propfind  to-be-fixed
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}  ${TESTDIR}
  ${bodyvalue}  Get PROPFIND ALLPROP body
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${output}  WebDAV PROPFIND  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${filename}  ${bodyvalue}  ${plainproxy}
  Log  ${output}
  Should Not Contain  ${output}  207 Multi-status
  Should Contain  ${output}  403

WebDAV PROPFIND allprop on non empty VOMS storage area directory as anonymous
  [Tags]  webdav  forbidden  propfind
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${dirname}  Get a unique name
  ${output}  WebDAV MKCOL  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${dirname}  ${vomsproxy}
  Should Contain  ${output}  201 Created
  ${subFile1}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}  ${TESTDIR}/${dirname}
  ${subFile2}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}  ${TESTDIR}/${dirname}
  ${bodyvalue}  Get PROPFIND ALLPROP body
  ${output}  WebDAV PROPFIND  ${davEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${dirname}  ${bodyvalue}
  Log  ${output}
  Should Not Contain  ${output}  207 Multi-status
  Should Contain  ${output}  403

WebDAV PROPFIND allprop on non empty VOMS storage area directory with plain proxy
  [Documentation]  It retrieves 500 instead of 403
  [Tags]  webdav  forbidden  propfind  to-be-fixed
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${dirname}  Get a unique name
  ${output}  WebDAV MKCOL  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${dirname}  ${vomsproxy}
  Should Contain  ${output}  201 Created
  ${subFile1}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}  ${TESTDIR}/${dirname}
  ${subFile2}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}  ${TESTDIR}/${dirname}
  ${bodyvalue}  Get PROPFIND ALLPROP body
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${output}  WebDAV PROPFIND  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${dirname}  ${bodyvalue}  ${plainproxy}
  Log  ${output}
  Should Not Contain  ${output}  207 Multi-status
  Should Contain  ${output}  403

########## COPY ###########

WebDAV COPY existent VOMS proxy storage area resource as anonymous
  [Tags]  webdav  forbidden  copy
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}
  ${output}  WebDAV COPY  ${davEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${filename}  ${davEndpoint}  ${ANONYMOUS_SA}  ${TESTDIR}/${filename}  T
  Log  ${output}
  Should Contain  ${output}  403

WebDAV COPY existent VOMS proxy storage area resource with plain proxy
  [Tags]  webdav  forbidden  copy
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${output}  WebDAV COPY  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${filename}  ${davSecureEndpoint}  ${PLAINPROXY_SA}  ${TESTDIR}/${filename}  T  ${plainproxy}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV COPY existent plain proxy storage area resource as anonymous
  [Tags]  webdav  forbidden  copy
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${PLAINPROXY_SA}  ${plainproxy}
  ${output}  WebDAV COPY  ${davEndpoint}  ${PLAINPROXY_SA}  ${TESTDIR}/${filename}  ${davEndpoint}  ${ANONYMOUS_SA}  ${TESTDIR}/${filename}  T
  Log  ${output}
  Should Contain  ${output}  403

########## MOVE ###########

WebDAV MOVE existent VOMS proxy storage area resource as anonymous
  [Tags]  webdav  forbidden  move
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}
  ${output}  WebDAV MOVE  ${davEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${filename}  ${davEndpoint}  ${ANONYMOUS_SA}  ${TESTDIR}/${filename}  T
  Log  ${output}
  Should Contain  ${output}  403

WebDAV MOVE existent VOMS proxy storage area resource with plain proxy
  [Tags]  webdav  forbidden  move
  ${vomsproxy}  Get WebDAV VOMS proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${vomsproxy}
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${output}  WebDAV MOVE  ${davSecureEndpoint}  ${VOMSPROXY_SA}  ${TESTDIR}/${filename}  ${davSecureEndpoint}  ${PLAINPROXY_SA}  ${TESTDIR}/${filename}  T  ${plainproxy}
  Log  ${output}
  Should Contain  ${output}  403

WebDAV MOVE existent plain proxy storage area resource as anonymous
  [Tags]  webdav  forbidden  move
  ${plainproxy}  Get WebDAV plain proxy credentials
  ${filename}  Upload file  ${davSecureEndpoint}  ${PLAINPROXY_SA}  ${plainproxy}
  ${output}  WebDAV MOVE  ${davEndpoint}  ${PLAINPROXY_SA}  ${TESTDIR}/${filename}  ${davEndpoint}  ${ANONYMOUS_SA}  ${TESTDIR}/${filename}  T
  Log  ${output}
  Should Contain  ${output}  403
