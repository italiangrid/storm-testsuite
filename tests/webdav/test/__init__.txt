*** Settings ***

Resource   lib/stormlib.txt
Resource   lib/credentials.txt
Resource   lib/webdav.txt

Suite Setup       Setup tests
Suite Teardown    Teardown tests

*** Keywords ***

Init local working directory
  Remove local directory  ${TESTDIR}
  Create local directory  ${TESTDIR}
  Execute and Check Success  cp ${TESTERS_CERT_SRC} ${TESTERS_CERT}
  Init certificate and plain proxy  test0
  Execute and Check Success  cp ${userproxy} ${GRID_PROXY}
  Init certificate and voms proxy  test0  ${vo}
  Execute and Check Success  cp ${userproxy} ${VOMS_PROXY}
  Clear all credentials

Clear remote anonymous working directory
  ${url}  Build webdav unsecure URL  ${ANONYMOUS_SA}  ${TESTDIR}
  ${output}  WebDAV anonymous DELETE  ${url}
  Log  ${output}

Clear remote plain proxy working directory
  ${url}  Build webdav secure URL  ${PLAINPROXY_SA}  ${TESTDIR}
  ${output}  WebDAV plain proxy DELETE  ${url}
  Log  ${output}

Clear remote voms proxy working directory
  ${url}  Build webdav secure URL  ${VOMSPROXY_SA}  ${TESTDIR}
  ${output}  WebDAV voms proxy DELETE  ${url}
  Log  ${output}

Init remote anonymous working directory
  ${url}  Build webdav unsecure URL  ${ANONYMOUS_SA}  ${TESTDIR}
  ${output}  WebDAV anonymous DELETE  ${url}
  Log  ${output}
  ${output}  WebDAV anonymous MKCOL  ${url}
  Log  ${output}
  Should Contain  ${output}  201 Created

Init remote plain proxy working directory
  ${url}  Build webdav secure URL  ${PLAINPROXY_SA}  ${TESTDIR}
  ${output}  WebDAV plain proxy DELETE  ${url}
  Log  ${output}
  ${output}  WebDAV plain proxy MKCOL  ${url}
  Log  ${output}
  Should Contain  ${output}  201 Created

Init remote voms proxy working directory
  ${url}  Build webdav secure URL  ${VOMSPROXY_SA}  ${TESTDIR}
  ${output}  WebDAV voms proxy DELETE  ${url}
  Log  ${output}
  ${output}  WebDAV voms proxy MKCOL  ${url}
  Log  ${output}
  Should Contain  ${output}  201 Created
  ${url}  Build webdav secure URL  ${NESTED_SA}  ${TESTDIR}
  ${output}  WebDAV voms proxy DELETE  ${url}
  Log  ${output}
  ${output}  WebDAV voms proxy MKCOL  ${url}
  Log  ${output}
  Should Contain  ${output}  201 Created
  ${url}  Build webdav secure URL  ${ALIASED_SA}  ${TESTDIR}
  ${output}  WebDAV voms proxy DELETE  ${url}
  Log  ${output}
  ${output}  WebDAV voms proxy MKCOL  ${url}
  Log  ${output}
  Should Contain  ${output}  201 Created

Setup tests
  Init local working directory
  Init remote anonymous working directory
  Init remote plain proxy working directory
  Init remote voms proxy working directory

Teardown tests
  Clear remote anonymous working directory
  Clear remote plain proxy working directory
  Clear remote voms proxy working directory
  Remove local directory  ${TESTDIR}

