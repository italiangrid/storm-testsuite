*** Settings ***
Resource   lib/stormlib.txt
Resource   lib/clientSRM.txt
Resource   lib/dcache.txt
Resource   lib/lcg_util.txt
Resource   lib/credentials.txt

*** Test Cases ***

Check if StoRM publishes correctly values for used and free space on the BDII
  [Tags]  regression
  [Setup]  Init certificate and voms proxy  test0  ${vo}
  ${filename}  Create local file
  ${surl}  Build surl  ${vo}  ${filename}
  Check file does not exists using lcg-utils  ${surl}
  Copy-out file using lcg-utils  ${filename}  ${surl}
  ${size_before}  Get unused size using clientSRM  ${storageAreaToken}
  Log  ${size_before}
  Check file exists using lcg-utils  ${surl}
  Perform rm using clientSRM  ${surl}
  Check file does not exists using lcg-utils  ${surl}
  ${size_after}  Get unused size using clientSRM  ${storageAreaToken}
  Log  ${size_after}
  ${diff_size}  Run  echo `expr ${size_after} - ${size_before}`
  ${file_size}  Run  ls -l /tmp/${filename} | awk {'print $5'}
  Should be equal  ${file_size}  ${diff_size}
  Remove local file  ${filename}
  [Teardown]  Clear all credentials

Status of bring online using a non existent token
  [Tags]  regression  sbol
  [Documentation]  Regression test for https://issues.infn.it/browse/STOR-217. StoRM crashed when a status for an async request was requested but the service is not able to get the into out of the database (for example, the token does not exists). This test calls a status for bring online.
  [Setup]  Init certificate and voms proxy  test0  ${vo}
  ${output}  Execute clientSRM Command  bol -t abcde
  [Teardown]  Clear all credentials
