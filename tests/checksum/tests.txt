*** Settings ***
Resource   lib/stormlib.txt
Resource   lib/clientSRM.txt
Resource   lib/lcg_util.txt
Resource   lib/credentials.txt
Resource   lib/globus_util.txt

*** Test Cases ***

Check checksum of copied file
  [Tags]  lcg-util
  [Documentation]  StoRM BE must be configured with GRIDFTP_WITH_DSI="yes" to pass this test
  [Setup]  Init certificate and voms proxy  test0  ${vo}
  ${filename}  Create local file
  ${srcsurl}  Build surl  ${vo}  ${filename}
  ${output}  ${token}  Perform ptp using clientSRM  ${srcsurl}  -p
  Copy-out file using globus-utils  ${filename}  ${vo}  ${filename}
  ${output}  Perform pd using clientSRM  ${srcsurl}  ${token}  -p
  ${destsurl}  Build surl  ${vo}  ${filename}_copied
  ${output}  Copy file using lcg-utils  ${srcsurl}  ${destsurl}  --checksum
  Log  ${output}
  Should Contain  ${output}  Source and destination checksums are matching
  ${output}  Perform rm using clientSRM  ${srcsurl}
  Should Contain  ${output}  SRM_SUCCESS
  ${output}  Perform rm using clientSRM  ${destsurl}
  Should Contain  ${output}  SRM_SUCCESS
  Remove local file  ${filename}
  [Teardown]  Clear all credentials