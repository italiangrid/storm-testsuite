*** Settings ***
Resource   lib/stormlib.txt

*** Test Cases ***

Check storm can be pinged
  ${output}  Execute clientSRM Command  ping
  Should contain  ${output}  SRM server successfully contacted
	
List files in storage area root
  Execute clientSRM Command on Surl  ls  srm://${srmEndpoint}/${root} -c 1

Create directory
  ${dirName}  Get a unique name
	Create directory using clientSRM  ${dirName}
	Remove directory using clientSRM  ${dirName}
	
Check double PtG on a file
  ${test_file}  Run  echo "test."`date "+%s"`
  Put without really putting  ${test_file}
  Prepare to get  ${test_file}
  Prepare to get  ${test_file}

Check right failure code when invoking PtP/PtP on the same file
  ${test_file}  Run  echo "test."`date "+%s"`
  Prepare to put  ${test_file}
  ${output}  Execute clientSRM Command on Surl  PtP -p  srm://${srmEndpoint}/${root}/${test_file}
  Log  ${output}
  Should Contain  ${output}  SRM_FILE_BUSY

Check right failure code when invoking PtP/pd/PtP on the same file
  ${test_file}  Run  echo "test."`date "+%s"`
  ${token}  Put without really putting  ${test_file}
  ${output}  Execute clientSRM Command on Surl  PtP -p  srm://${srmEndpoint}/${root}/${test_file}
  Should Contain  ${output}  SRM_DUPLICATION_ERROR

Check if StoRM publishes correctly values for used and free space on the BDII
  ${test_file}  Create local file
  Check file does not exists using lcg-utils  ${test_file}
  Copy file using lcg-utils  ${test_file}  ${test_file}
  ${size_before}  Get unused size  ${storageAreaToken}
  Log  ${size_before}
	Check file exists using lcg-utils  ${test_file}
  Execute clientSRM Command  rm -e httpg://${srmEndpoint}/ -s srm://${srmEndpoint}/srm/managerv2?SFN=/${root}/${test_file}
	Check file does not exists using lcg-utils  ${test_file}
	${size_after}  Get unused size  ${storageAreaToken}
  Log  ${size_after}
  ${diff_size}  Run  echo `expr ${size_after} - ${size_before}`
  ${file_size}  Run  ls -l /tmp/${test_file} | awk {'print $5'}
  Should be equal  ${file_size}  ${diff_size}

