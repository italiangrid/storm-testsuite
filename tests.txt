*** Settings ***
Resource   lib/stormlib.txt

*** Test Cases ***

Check storm can be pinged
  ${output}  Execute clientSRM Command  ping
  Should contain  ${output}  SRM server successfully contacted
	
List files in storage area root
  Execute clientSRM Command on Surl  ls  srm://${srmEndpoint}/${root} -c 1

Create directory
  ${rc}  ${dirName}  Run And Return Rc And Output  echo $RANDOM
  Execute clientSRM Command on Surl  mkdir  srm://${srmEndpoint}/${root}/${dirname}
  Execute clientSRM Command on Surl  rmdir  srm://${srmEndpoint}/${root}/${dirname}

Check double PtG on a file
  ${test_file}  Run  echo "test."`date "+%s"`

  ${output}  Execute clientSRM Command on Surl  PtP  srm://${srmEndpoint}/${root}/${test_file}
  ${result}  ${token}=  Should Match Regexp  ${output}  requestToken=(\".+\")
  Run  sleep 2

  ${output}  Execute clientSRM Command on Surl  pd  srm://${srmEndpoint}/${root}/${test_file} -t ${token}

  Execute clientSRM Command on Surl  ptg  srm://${srmEndpoint}/${root}/${test_file}
  Run  sleep 2

  ${output}  Execute clientSRM Command on Surl  ptg  srm://${srmEndpoint}/${root}/${test_file}
  ${result}  ${token}=  Should Match Regexp  ${output}  requestToken=(\".+\")
  Run  sleep 2

  ${output}  Execute clientSRM Command on Surl  sptg  srm://${srmEndpoint}/${root}/${test_file} -t ${token}

  Log  ${output}
  Should Not Contain  ${output}  SRM_FILE_BUSY
