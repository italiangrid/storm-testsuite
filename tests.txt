*** Settings ***
Resource   lib/stormlib.txt

*** Test Cases ***

Check storm can be pinged
  ${output}  Execute clientSRM Command  ping
  Should contain  ${output}  SRM server successfully contacted
	
List files in storage area root
  Execute clientSRM Command on Surl  ls  srm://${srmEndpoint}/${root} -c 1

Create directory
  ${rc}  ${dirName}  Run And Return Rc And Output  echo $RANDOM
  Execute clientSRM Command on Surl  mkdir  srm://${srmEndpoint}/${root}/${dirname}
  Execute clientSRM Command on Surl  rmdir  srm://${srmEndpoint}/${root}/${dirname}

Check double PtG on a file
  ${test_file}  Run  echo "test."`date "+%s"`

  ${output}  Execute clientSRM Command on Surl  PtP -p  srm://${srmEndpoint}/${root}/${test_file}
  ${result}  ${token}=  Should Match Regexp  ${output}  requestToken=(\".+\")
  Should Contain  ${output}  SRM_SUCCESS

  ${output}  Execute clientSRM Command on Surl  pd -p  srm://${srmEndpoint}/${root}/${test_file} -t ${token}
  Should Contain  ${output}  SRM_SUCCESS

  ${output}  Execute clientSRM Command on Surl  ptg -p  srm://${srmEndpoint}/${root}/${test_file}
  Should Contain  ${output}  SRM_SUCCESS

  ${output}  Execute clientSRM Command on Surl  ptg -p  srm://${srmEndpoint}/${root}/${test_file}
  Should Not Contain  ${output}  SRM_FAILURE

Check right failure code when invoking PtP/PtP on the same file
  ${test_file}  Run  echo "test."`date "+%s"`

  ${output}  Execute clientSRM Command on Surl  PtP -p  srm://${srmEndpoint}/${root}/${test_file}
  Should Contain  ${output}  SRM_SUCCESS

  ${output}  Execute clientSRM Command on Surl  PtP -p  srm://${srmEndpoint}/${root}/${test_file}
  Log  ${output}
  Should Contain  ${output}  SRM_FILE_BUSY

Check right failure code when invoking PtP/pd/PtG on the same file
  ${test_file}  Run  echo "test."`date "+%s"`

  ${output}  Execute clientSRM Command on Surl  PtP -p  srm://${srmEndpoint}/${root}/${test_file}
  Should Contain  ${output}  SRM_SUCCESS
  ${result}  ${token}=  Should Match Regexp  ${output}  requestToken=(\".+\")

  ${output}  Execute clientSRM Command on Surl  pd -p  srm://${srmEndpoint}/${root}/${test_file} -t ${token}
  Should Contain  ${output}  SRM_SUCCESS

  ${output}  Execute clientSRM Command on Surl  PtP -p  srm://${srmEndpoint}/${root}/${test_file}
  Should Contain  ${output}  SRM_DUPLICATION_ERROR
