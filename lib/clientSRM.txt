** Settings ***

Library   OperatingSystem
Resource   variables.txt

*** Keywords ***

Execute clientSRM Command  [Arguments]  ${cmd}
  ${output}  Execute and Check Success  clientSRM ${cmd} -e ${srmEndpoint}
  [Return]  ${output}

Execute clientSRM Command on Surl  [Arguments]  ${cmd}  ${surl}
  ${output}  Execute and Check Success  clientSRM ${cmd} -e ${srmEndpoint} -s ${surl}
  [Return]  ${output}

Execute clientSRM Command on Surl with Token  [Arguments]  ${cmd}  ${surl}  ${token}
  ${output}  Execute and Check Success  clientSRM ${cmd} -e ${srmEndpoint} -s ${surl} -t ${token}
  [Return]  ${output}

Create directory using clientSRM  [Arguments]  ${dirname}
  ${output}  Execute clientSRM Command on Surl  mkdir  srm://${srmEndpoint}/${root}/${dirname}
	Should Contain  ${output}  SRM_SUCCESS

Try to create directory using clientSRM  [Arguments]  ${dirname}
  ${output}  Execute clientSRM Command on Surl  mkdir  srm://${srmEndpoint}/${root}/${dirname}
	Should Not Contain  ${output}  SRM_SUCCESS
	[Return]  ${output}

List files in directory using clientSRM  [Arguments]  ${path}
  ${output}  Execute clientSRM Command on Surl  ls  srm://${srmEndpoint}/${root}/${path}  
  [Return]  ${output}

Detailed Ls on resource using clientSRM  [Arguments]  ${path}
  ${output}  Execute clientSRM Command on Surl  ls -l -c 1  srm://${srmEndpoint}/${root}/${path}
  [Return]  ${output}

Remove directory using clientSRM  [Arguments]  ${dirname}
  ${output}  Execute clientSRM Command on Surl  rmdir  srm://${srmEndpoint}/${root}/${dirname} -r 1
  Should Contain  ${output}  SRM_SUCCESS

Try to remove directory using clientSRM  [Arguments]  ${dirname}
  ${output}  Execute clientSRM Command on Surl  rmdir  srm://${srmEndpoint}/${root}/${dirname} -r 1
  Should Not Contain  ${output}  SRM_SUCCESS
	[Return]  ${output}

Remove file using clientSRM  [Arguments]  ${path}
  ${output}  Execute clientSRM Command on Surl  rm  srm://${srmEndpoint}/${root}/${path}
  Should Contain  ${output}  SRM_SUCCESS

Try to remove file using clientSRM  [Arguments]  ${path}
  ${output}  Execute clientSRM Command on Surl  rm  srm://${srmEndpoint}/${root}/${path}
  Should Not Contain  ${output}  SRM_SUCCESS
	[Return]  ${output}

Prepare to put  [Arguments]  ${path}  ${filename}  ${extraParams}=${EMPTY}
  ${output}  Execute clientSRM Command on Surl  ptp -p ${extraParams}  srm://${srmEndpoint}/${root}/${path}/${filename}
  ${result}  ${token}=  Should Match Regexp  ${output}  requestToken=(\".+\")
  [Return]  ${output}  ${token}  

Put without really putting  [Arguments]  ${path}  ${filename}
	${output}  ${token}  Prepare to put  ${path}  ${filename}
	${output}  Execute clientSRM Command on Surl  pd -p  srm://${srmEndpoint}/${root}/${path}/${filename} -t ${token}
  Should Contain  ${output}  SRM_SUCCESS

Put done  [Arguments]  ${path}  ${filename}  ${token}
  ${output}  Execute clientSRM Command on Surl with token  pd  srm://${srmEndpoint}/${root}/${path}/${filename}  ${token}
  Should Contain  ${output}  SRM_SUCCESS

Prepare to get  [Arguments]  ${filename}  ${extraParams}=${EMPTY}
  ${output}  Execute clientSRM Command on Surl  ptg -p ${extraParams}  srm://${srmEndpoint}/${root}/${test_file}
  ${result}  ${token}=  Should Match Regexp  ${output}  requestToken=(\".+\")
  [Return]  ${output}  ${token}

Get unused size  [Arguments]  ${storageAreaToken}
  ${output}  Execute clientSRM Command  gst -e httpg://${srmEndpoint}/ -d ${storageAreaToken}
  ${result}  ${token}=  Should Match Regexp  ${output}  (\".+-.+-.+-.+-.+\")
  ${output}  Get space metadata  ${token}
  ${result}  ${unusedSize}=  Should Match Regexp  ${output}  unusedSize=(.+)
  [Return]  ${unusedSize}

Get space metadata  [Arguments]  ${token}
  ${output}  Execute clientSRM Command  gsm -e httpg://${srmEndpoint}/ -s ${token}
  [Return]  ${output}

Reserve space
  ${output}  Execute clientSRM Command  rs -e httpg://${srmEndpoint}/ -a 10 -b 5 -r 0,0
  ${result}  ${token}=  Should Match Regexp  ${output}  (\".+-.+-.+-.+-.+\")
  [Return]  ${token}

Release space  [Arguments]  ${token}
  ${output}  Execute clientSRM Command  rsp -e httpg://${srmEndpoint}/ -t ${token} -f 1
  [Return]  ${output}

Get space token
  ${output}  Execute clientSRM Command  gst -v ES -e httpg://${srmEndpoint} -d ${storageAreaToken}
  ${result}  ${token}=  Should Match Regexp  ${output}  (\".+-.+-.+-.+-.+\")
  [Return]  ${token}
